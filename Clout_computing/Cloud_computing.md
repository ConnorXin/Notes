# 云计算基础知识

## 云计算背景

随着移动互联网、全联接时代的到来，越来越多的终端设备被投入使用，每天都会有大量的数据产生，传统的 ICT 基础设施也在面临着前所未有的挑战

互联网的到来，给企业带来了大量的流量、用户以及数据，传统 IT 架构已经不能满足企业高速发展的需求

- 业务上线慢

- 扩展困难

- 可靠性不强，大多采用集中式架构

- 生命周期管理复杂

- I / O 瓶颈导致延迟

- 企业总拥有成本 TCO 居高不下

**越来越多企业 IT 基础设施架构开始走向云化**

走向云化主要经历了以下三个<mark>架构模式</mark>

1. 传统企业 IT 架构
   
   ![](%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20172257.png)

2. 虚拟化架构
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20172353.png)

3. 企业云化 IT 架构
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20172407.png)

IT 核心：以数据中心为基础的核心架构

**<mark>Cloud OS</mark>**

- 计算虚拟化

- 存储虚拟化

- 网络虚拟化

<font color = cornflowerblue>cmd 命令查看路由表: `route print`</font>

## 云计算定义

引用 美国国家技术和标准研究院 NIST

Cloud computing is a model for enabling ubiquitous, conbenient, on-demand network access to a shared pool of configurable computing resources (e.g., networks, servers, storage, applications and services) that can be rapidly provisioned and released with minimal management effort or service provider interaction.

云计算是一种模型，它可以实现随时随地，便捷地，随需应变地从可配置计算<font color = Red>资源共享池</font>中获取所需的资源 (e.g.  网络，服务器，存储，应用，及服务)，资源能够<font color = Red>快速供应并释放</font>，使管理资源的工作量和与服务提供商的<font color = Red>交互减小到最低</font>限度

> 虚拟化不代表是云计算，只是云计算需要用到虚拟化这个功能
> 
> <font color = Red>云计算无法提高设备的性能，可以提高设备资源利用率</font>

## 云计算的五大特质

1. **<font color = cornflowerblue>按需自助服务  On-demand Self-service</font>**

2. **<font color = cornflowerblue>广泛网络接入  Broad Network Access</font>**
   
   多个网络可以接入云平台

3. **<font color = cornflowerblue>资源池化  Resource Pooling</font>**
   
   一是物理资源全部虚拟化成一个池，需要就从里面拿
   
   二是标准化；虚拟化之后，不管是什么 CPU，不管是什么存储，将它们格式化成相同的一种格式

4. **<font color = cornflowerblue>快速弹性伸缩  Rapid Rlasticity</font>**

5. **<font color = cornflowerblue>可计量服务  Measured Service</font>**

## 云计算的模式

**<mark>云计算商业模式的变化：从自建到租用</mark>**

1. 企业由纯粹的自建 IT 系统逐步转向混合云的模式

2. 部分核心应用私有云，一般应用租用公有云服务

![](./屏幕截图%202022-11-15%20205649.png)

---

**<mark>云计算建设模式的变化：从烟囱到水平</mark>**

![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20210130.png)

---

**<mark>云计算建设模式：从虚拟化向以应用为核心演进</mark>**

![](./屏幕截图%202022-11-15%20210318.png)

云计算主要以资源为核心

### 四类部署模式

1. **<font color = cornflowerblue>私有云  Private Cloud</font>**
   
   企业利用自有或租用的基础设施资源自建的云，不对外

2. **<font color = cornflowerblue>社区云 / 行业云  Community Cloud</font>**
   
   为特定社区或行业所构建的共享基础设施的云，其实是归属于公有云里面

3. **<font color = cornflowerblue>公有云  Public Cloud</font>**
   
   出租给公众的大型的基础设施的云

4. **<font color = cornflowerblue>混合云  Hybrid Cloud</font>**
   
   由两种或两种以上部署模式组成的云；两种公有云也是混合云

### 三种服务模式

1. **<font color = cornflowerblue>IaaS</font>**
   
   云基础设施即服务
   
   出租处理能力、存储空间、网络容量等基本计算资源

2. **<font color = cornflowerblue>PaaS</font>**
   
   云平台即服务
   
   为客户开发的应用程序提供可部署的云环境

3. **<font color = cornflowerblue>SaaS</font>**
   
   云软件即服务
   
   在网络上提供可直接使用的应用程序

![](./屏幕截图%202022-11-15%20212635.png)

## 云计算的八个通用点

1. 大规模 Massive scale

2. 同质化 Homogeneity

3. 虚拟化 Virtualization

4. 弹性计算 Resilient computing

5. 低成本软件 Low cost software

6. 地理分布 Geographic distribution

7. 服务定位 Service orientation

8. 先进安全技术 Adcanced secrity technologies

# 云计算的价值

趋势：以云计算为基础的 “第三平台” 已经成为 IT 产业主流

![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20204201.png)

![](./屏幕截图%202022-11-15%20204406.png)


# 云计算的架构

- 基于云计算，支持用户随时随地使用业务，移动和社交媒体改变客户使用业务的体验

- 基于弹性扩展云计算架构的 IT 系统，支撑海量用户带来的性能压力

- 云计算架构下，资源和能力就绪，以服务的方式开放给开发者和用户，快速开发部署新业务

- 以合理成本建设云计算平台，支持业务发展

# 云计算基础技术

## 技术发展历程

![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20214019.png)


**云计算技术体系：核心技术识别**

![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-15%20220103.png)


## 关键技术

1. <mark>**计算架构**</mark>
   
   模式：Scale Out 【横向扩展】
   
   ![](./屏幕截图%202022-11-15%20220911.png)
   
   多台小服务器，合并充当大服务器的性能
   
   这样，整体性能最优；用软件将它们连接起来（基于软件可靠性）
   
   若一台故障，其他还能使用
   
   可扩展性强一些
   
   > 【纵向扩展】
   > 
   > 单台服务器一直升级

2. <mark>**云计算硬件**</mark>
   
   > 数据中心的联网
   
   服务器：高可靠性，高性能
   
   网络：高密度以太网交换机
   
   存储：低成本、多备份
   
   ![](./屏幕截图%202022-11-15%20234507.png)

3. <mark>**云计算软件**</mark>
   
   > 集群管理
   
   - 并行计算技术
     
     同时计算
   
   - 分布式存储
     
     一个文件可以存储在多台服务器中
     
     可以是一个文件分成多份存储在多台服务器中
     
     也可以是一个文件备份在多台服务器中
   
   - 分布式文件管理
   
   - 虚拟化技术
   
   - 智能化云计算系统管理技术

# 华为云解决方案

主要讲述华为云计算的不同解决方案；介绍了服务器虚拟化、云数据中心、桌面云、公有云等解决方案的架构与特点

## FusionSphere解决方案

### ~ 概览

FusionSphere 定位 IT 与 CT 统一的云基础设施平台软件，聚焦于服务器虚拟化、云数据中心、和 NFVI 的交付

> NFVI: 网络功能虚拟化

- <mark>聚焦华为的虚拟化平台</mark>
  
  通过计算虚拟化、网络虚拟化和存储虚拟化构筑差异化竞争力，支持异构虚拟化接入

- <mark>聚焦 OpenStack 社区</mark>
  
  保持系统开放性以及与社区生态的兼容性

- <mark>聚焦 IaaS 层能力</mark>
  
  软硬件解耦，对设备业务面集成，确保产品可以批量复制；对于产品线定制化场景，Fusionsphere 可以作为平台部件被其它产品线集成，由各产品线定制自己的解决方案

### ~ 定位

![](./屏幕截图%202022-11-16%20000418.png)

### ~ 架构

![](./屏幕截图%202022-11-16%20001134.png)

- FusionCompute
  
  UVP-KVM 虚拟化；UVP-XEN 虚拟化
  
  VRM 虚拟机或实体机去管理以上两个服务器

- FusionStorage
  
  > 提供存储

- FusionNetwork
  
  > 由 Openstack 中的 Neutron 提供二层的交换能力

- Openstack
  
  对更多的资源进行管理
  
  - Nova
    
    对我们多个计算节点进行管理
  
  - KeyStone
    
    对多个平台进行认证
  
  - Cinder
    
    对卷管理

- ManageOne SC
  
  对服务器进行业务的发放；栈连内部的管理

- ManageOne OC
  
  对不同的产品进行检测 jian'kuan 情况，还有监控
  
  例如对 SC 里面的虚拟机、云硬盘、弹性主机等等进行检测 jian'kuan 情况，还有监控

### ~ 部件与场景组合关系

![](./屏幕截图%202022-11-16%20002941.png)

| 部件                       | 定位               | 主要功能                                                              |
| ------------------------ | ---------------- | ----------------------------------------------------------------- |
| FusionCompute            | 企业级虚拟化软件         | 面向 IT 为中心的资源供给模式；<u>计算虚拟化，网络虚拟化，存储虚拟化，集群管理，虚拟化层基础运维</u>           |
| OpenStack OM             | 云管理功能            | 面向组织的 IT 敏捷供给模式，面向运营的资源池管理；资源池化，多站点，异构虚拟化，云层基础运维                  |
| FusionStorage            | 分布式存储            | 分布式存储，提升瘦分配，链接克隆，快照，备份等高级功能                                       |
| FusionSphere / OpenStack | 华为 OpenStack 企业版 | 华为基于 OpenStack 社区版本进行增强、加固后的企业版本                                  |
| UltraVR                  | 容灾方案             | 基于 SAN 设备<mark>异步</mark>复制的容灾方案                                   |
| eBackup                  | 备份方案             | 基于虚拟存储的备份，备份计划，差异增量，累积增量                                          |
| SOI                      | 系统运行洞察           | FusionSphere SOI 是性能监控和分析系统，根据历史和当前数据对未来性能变化进行预测，从而为管理员提供系统性能管理建议 |

> <mark>异步</mark>: 当所有操作完成后，内容再复制过去

### 服务器虚拟化场景

1. **<font color = cornflowerblue>计算资源虚拟化</font>**
   
   ![](./屏幕截图%202022-11-16%20005019.png)
   
   > 单位 CPU 虚拟化能力数值越大，代表所占用的物理资源约低，因此 KVM6.1, UVP3.0 常用
   
   - 计算虚拟化要确保系统极高的可靠性
   
   - 虚拟化软件对物理资源的消耗要降到最低，把更多的资源留给应用

2. **<font color = cornflowerblue>存储资源虚拟化</font>**
   
   ![](./屏幕截图%202022-11-16%20005712.png)
   
   - 存储虚拟化要提供比 SAN 更高的读写性能
   
   - 大数据助推海量存储需求，要大幅降低存储设备投资额
   
   > 精简磁盘

3. **<font color = cornflowerblue>网络 / 安全资源虚拟化</font>**
   
   ![](./屏幕截图%202022-11-16%20005926.png)
   
   - 网络虚拟化要为高密度虚拟机环境消除网络 I / O 瓶颈，降低 CPU 消耗【图中后面两者才能降低】
   
   - 安全虚拟化要在系统层面提升虚拟机的安全等级，提供物理安全设备的功能

### 企业融合云数据中心架构图

![](./屏幕截图%202022-11-16%20010817.png)

资源池为异构资源池，需要一个集中管理，使用 FusionSphere OpenStack 进行集中管理

Manage One 进行资源的分发

### 逻辑架构

![](./屏幕截图%202022-11-16%20011401.png)

### 架构特点

- 高效
  
  - <font color = cornflowerblue>模板化、自动化应用部署</font>
    
    ![](./屏幕截图%202022-11-16%20102253.png)
    
    丰富的模板服务，拖拽式操作，全自动的业务部署、卸载模式
    
    - R1: 路由器
    
    - Subnet: 网站
  
  - <font color = cornflowerblue>资源弹性伸缩 / SLA 资源池</font>
    
    ![](./屏幕截图%202022-11-16%20102606.png)
    
    虚拟资源分 SLA 提供，为满足不同业务对虚拟资源的要求；虚拟资源按业务需求，弹性伸缩，提升资源利用效率
  
  - 端到端完整的工程实施方案

- 安全
  
  - <font color = cornflowerblue>端到端的系统安全优化</font>
    
    1. 系统精简加固，提升安全
       
       通过精简 OS、服务加固、内核调整、审计日志等措施，提升虚拟化平台的安全性
    
    2. 网络安全隔离
       
       通过业务网络和基础平台网络隔离、虚拟机局域网 VLAN 隔离、安全组隔离、动态 ARP 检测、广播报文抑制等措施，保证网络安全
    
    3. 账号安全管理
       
       遵从账户 - 角色模型；每个角色分权（具体到创建虚拟机、创建卷等操作）分域（按逻辑集群维度）
    
    4. 用户信息安全
       
       通过数据访问空值、Bit 清零、数据盘加密等技术，保证用户信息安全
       
       > Bit 清零
       > 
       > 使用 0 比特字位把文件全部覆盖掉
    
    > 【客户价值】
    > 
    > 提供统一、全面的安全策略；具备低安全措施成本；可以按需提供安全防护
    > 
    > 【行业应用】
    > 
    > 多个政务云项目要求云平台必须具备全面的、可控的系统安全设计，需满足政务系统对安全管控的要求，除系统级全面安全加固外，华为云平台独有的管理员 “三员分立”、“用户信息彻底清楚技术” 深受客户认可
  
  - 卓越的产品可靠性设计
  
  - <font color = cornflowerblue>虚拟化防病毒</font>
    
    ![](./屏幕截图%202022-11-16%20110009.png)
    
    > 【客户价值】
    > 
    > 避免杀毒风暴，单虚拟机用户系统负载降低，体验提升10%以上；
    > 
    > 集中管理，无需对每个虚拟机安装和升级病毒库，省时、省事、省资源；
    > 
    > 【行业应用】
    > 
    > 某企业虚拟化平台使用传统防病毒产品时，需专人定期进行服务器全盘扫描，且每个用户虚拟机需安装杀毒软件和定期更新。
    > 
    > 采用虚拟化无代理防病毒功能后，可实现统一管理机制，功耗更低，用户体验更好。

- 融合
  
  - <font color = cornflowerblue>云和非云资源统一管理</font>
    
    > 从底层硬件到上层应用实现统一管理，统一视图
    > 
    > 实现多厂商设备和软件的异构管理，提升效率
    
    1. 硬件设备、虚拟资源，应用统一管理
       
       FusionManager 云管理支持直接管理底层的硬件设备、虚拟资源及上层部署的应用，实现统一管理和监控，提升运维效率
    
    2. 异构硬件管理，异构虚拟化管理
       
       FusionManager 具备广泛的软硬件兼容性，能够支持异构管理业界主流厂商的服务器，存储和网络设备，也支持主流虚拟化平台，节省管理节点，降低管理维护复杂度
    
    3. 云和非云资源的统一管理
       
       支持对裸机物理服务器的自动发现、资源管理和自动发放等功能，快速实现资源池管理；
       
       同时，基于部分关键业务诉求，可以选择部分物理服务器作为物理机使用（不进行虚拟化）
    
    > 【客户价值】
    > 
    > 各层级资源统一管理，有效降低了云计算系统内部的多厂商设备的管理复杂度，提升管理效率，让管理员可以更加聚焦无业务支撑
    > 
    > 【行业应用】
    > 
    > 某研究机构需要将办公平台和实验室系统进行虚拟化改造，但有两个高性能实验项目不希望切换到虚拟化平台上；
    > 
    > 通过 FusionManager 的资源统一管理，实现了云和非云的所有物理资源的统一管理，简化了管理复杂度。
  
  - <font color = cornflowerblue>多数据中心管理</font>
    
    ![](./屏幕截图%202022-11-16%20112317.png)
    
    一个 FusionManager 管理多个节点（级联）
    
    > 【客户价值】
    > 
    > 多个数据中心资源集中规划，统一分配，扩大资源共享范围，提高资源利用率；
    > 
    > 跨地域多个数据中心资源统一监控和维护，进一步简化数据中心管理；
    > 
    > 【行业应用】
    > 
    > 某运营商原本分散在全国各地的多个数据中心只能分散独立管理，但通过分层部署 FusionManager 实现了多数据中心的统一管理，资源统一规划和分配，统一监控和维护，运营运维效果有效提升。
  
  - 计算存储融合
  
  - <font color = cornflowerblue>混合云管理</font>
    
    > 实现私有云资源无缝扩展到公有云资源，实现 IT 投资的效率和成本之间的最佳平衡
    
    ![](./屏幕截图%202022-11-16%20112816.png)
    
    > 【客户价值】
    > 
    > 1. 敏捷 ---- 统一管理企业在公有云和私有云的资源；
    > 
    > 2. 业务可移植 ---- 业务资源在公有云与私有云之间流动；
    > 
    > 3. 灵活扩展 ---- 通过混合云实现最优的资源配置和调度。
    > 
    > ![](./屏幕截图%202022-11-16%20113005.png)
    > 
    > - Load Balance: 负载均衡器设备
    > 
    > - Web Server: 服务器
    > 
    > - VPN: 通过 vpn 连接到公有云
    > 
    > - AWS:  亚马逊

- 开放
  
  - <font color = cornflowerblue>开放 API</font>
    
    1. FusionSphere 开放 API
    
    2. SNMP 网管接口
       
       SNMP 简单的网络告警
    
    > 第三方管理平台，可以通过 API，实现虚拟机、VPC、虚拟存储、虚拟网络、虚拟防火墙等的管理
    > 
    > 通过 SNMP 网管接口，可以监控云平台的告警上报

- 故障检测
  
  - <font color = cornflowerblue>故障快速检测和自动恢复</font>
    
    ![](./屏幕截图%202022-11-16%20102748.png)
    
    使用 SOI 进行检查
  
  - <font color = cornflowerblue>精细化故障预防系统</font>
    
    1. 系统运行记录仪
       
       全面记录虚拟化平台和虚拟机的运行状态
    
    2. 故障预防工具
       
       报告系统健康状态，预先发现系统隐患提前排除
    
    3. 精细化探针
       
       探针程序检测节点或者虚拟机的异常信息
    
    4. 应用监控
       
       根据用户自定义监控指标和阈值监控，判断应用状态，如异常发送告警
    
    > 【客户价值】
    > 
    > 通过系统运行自动分析可以提前排除因业务系统本身软件的异常，减少系统故障带来的业务损失
    > 
    > 【行业应用】
    > 
    > 在某公有云运营商中，通过华为的系统运行分析发现其客户某个业务对于系统内存需要持续不断但少量的增加，持续三个月系统内存需求一直在增加，判断业务软件有内存泄漏情况，运营商通过分析告知其客户，并最终解决客户的业务软件问题，帮助客户获得客户满意

- 主机复制容灾
  
  - <font color = cornflowerblue>基于云操作系统的主机复制容灾</font>
    
    > 降低容灾部署成本
    
    ![](./屏幕截图%202022-11-16%20105628.png)
    
    > 【客户价值】
    > 
    > 基于云操作系统本身实现主机复制容灾，无需独立存储硬件进行容灾，降低容灾成本，RPO >= 10s，RTP <= 3min，确保容灾业务的高可靠和可用性
    > 
    > 【行业应用】
    > 
    > 多家企业通过直接使用虚拟主机容灾方案，不再需要额外采购部署容灾业务的存储设备，极大地降低了部署成本

## 桌面云解决方案 —— FusionAccess

### 桌面云

![](./屏幕截图%202022-11-16%20015942.png)

传统 PC 办公面临的困境

- 用户体验差
  
  - 图片不清晰
  
  - VOIP 时延大
  
  - 视频不流畅

- 管理员管理难
  
  - 缺少管理工具
  
  - 大量来自用户的请求
  
  - 系统复杂，故障定位困难

- 决策者风险高
  
  - 引入不可控的安全风险
  
  - 桌面集中管理后，引入灾、备的诉求

### ~ 连接原理图

![](./屏幕截图%202022-11-16%20021119.png)

- HDP 协议: 华为的桌面协议
  
  协议可以减掉大量重复的内容，加快传输数据，能够解决画面不清晰的问题

- 负载均衡器
  
  可以分发不同的虚拟机

- FusionSphere
  
  物理设备在这里面，创建的所有虚拟机都是 FusionAccess 下发命令给 FusionSphere

### ~ 架构优势

![](./屏幕截图%202022-11-16%20022019.png)

- **业务发放自动化**
  
  版本创建虚拟机及关联用户全自动，业务发放更简便
  
  一种是专属的虚拟机；一种是公共的虚拟机，找空闲的分发用户

- **单套管理界面用户容量大**
  
  单套 HDC 桌面控制器可管理5000桌面；
  
  一套 ITA 支持管理多套 HDC 的方式，最大可管理20000桌面

- **减少连接类可靠性问题**
  
  支持 HDA 进程看护，文件防误删，服务端口的协商机制，提升用户 VM 中 HDA 运行态的可靠性；
  
  提供 AD 故障的应急通道，解决域控或 Windows 服务故障经常导致大量的连接性断连问题

**<font color = Red>【保障用户办公体验】</font>**

基于华为自研 "HDP" 协议，完美解决早期虚拟桌面体验差、兼容性差、管理难等问题

**<font color = Red>【完善的 GPU 支撑方案】</font>**

GPU 显卡

![](./屏幕截图%202022-11-16%20023236.png)

|                      | GPU 直通                      | GPU 硬件虚拟化                   | GPU 共享                |
| -------------------- | --------------------------- | --------------------------- | --------------------- |
| 适用场景                 | 复杂图纸编辑，图纸总装；复杂视频编辑，中高端游戏    | 中等复杂图纸编辑；视频编辑，终端游戏          | 查阅图纸，轻量编辑；中低端游戏       |
| DirectX, OpenGL 图形规范 | OpenGL 4.4; DirectX 9/10/11 | OpenGL 4.4; DirectX 9/10/11 | OpenGL 2.1; DirectX 9 |

<mark>4K 视频编辑：流畅的视频编辑体验</mark>

![](./屏幕截图%202022-11-16%20024324.png)

HDP 协议可以让我们在其他办公区域的这个交换机也可以连接使用到精编的工作站，可以直接调用 GPU，进行高密度的操作

---

<mark>Skype 音视频分离</mark>

![](./屏幕截图%202022-11-16%20024619.png)

---

<mark>广域网优化：增强桌面办公的网络 QoS 容忍度</mark>

![](./屏幕截图%202022-11-16%20024922.png)

**<font color = Red>【公有桌面最佳方案：全内存桌面】</font>**

> 一些呼叫中心、学生电教室等应用型场景

![](./屏幕截图%202022-11-16%20025746.png)

<mark>关键技术</mark>

1. 内存去重压缩和复用技术
   
   桌面 VM 的系统盘放到内存中，重启还原最初始状态

2. 全内存 VDI 存储
   
   突破内存介质专用的实时在线重删技术、在线压缩技术；提供高速 IO 能力和高速克隆能力，提供超过 300 IOPS 每桌面

3. VM 磁盘读写操作，转化为内存操作，批量创建分发等管理效率大幅提升

**<font color = Red>【全面灵活的 E2E 安全防护设计】</font>**

![](./屏幕截图%202022-11-16%20030312.png)

**<font color = Red>【完善的业务容灾能力】</font>**

> 如何保障灾难发生后的业务继续运行
> 
> 如何减少整个站点故障时业务中断时间和用户数据丢失量，减少损失

1. **<font color = cornflowerblue>GSLB (global server load balancing) 业务冗余容灾方案</font>**
   
   针对关键业务用户，在两个数据中心内分别为其分配桌面资源
   
   ![](./屏幕截图%202022-11-16%20030804.png)

2. **<font color = cornflowerblue>TC 主动探测业务容灾方案</font>**
   
   没部署 GSLB 情况下，由 TC 上软件进行生成和灾备中心的健康检查
   
   ![](./屏幕截图%202022-11-16%20030929.png)

**<font color = Red>【系列工具，简化管理与故障诊断】</font>**

> 快速收集故障信息，通过一些工具，让用户可以进行类似传统 PC 的虚拟桌面问题的自诊断自处理，从而提升用户体验和管理效率

![](./屏幕截图%202022-11-16%20031238.png)

**<font color = Red>【全方位可靠性保障机制】</font>**

![](./屏幕截图%202022-11-16%20031333.png)

**<font color = Red>【完善的分支机构部署能力】</font>**

![](./屏幕截图%202022-11-16%20031646.png)

- 企业分支机构办公

- 分支营业厅

- 教育云平台各学校

- 政府公共事业平台分支

**<font color = Red>【基础特性增强】</font>**

1. <mark>Linux 桌面增强</mark>
   
   - 单屏最大 2480*1920
   
   - 双屏显示
   
   - 窗口化
   
   - 本地账户登录

2. <mark>高清制图增强</mark>
   
   - Tesla M60 GPU 卡和 GRID 3.0
   
   - 最多支持32个 GPU

3. <mark>池化桌面增强</mark>
   
   - 用户与池化桌面绑定功能
   
   - 完整复制动态指定用户权限组能力

4. <mark>SBC 应用增强</mark>
   
   - 应用分类
   
   - 登录时交互式消息策略
   
   - MAC OS 支持登录 SBC
   
   - 查看上次会话持续时间

5. <mark>客户端增强</mark>
   
   - 硬浮点 ARM 客户端
   
   - MAC OS 上软客户端支持双屏显示
   
   - 移动客户端登录支持支付多域

6. <mark>剪切板重定向增强</mark>
   
   - 文件通过剪切板从虚拟机复制到客户端

**<font color = Red>【卓越体验增强】</font>**

1. <font color = cornflowerblue>移动办公触屏优化</font>
   
   - 智能终端接入 Windows10 桌面平板模式
   
   - Windows10 原生操作体验

2. <font color = cornflowerblue>接入界面配置</font>
   
   - WI 登录界面系统 LOGO 框和每日提醒框可隐藏
   
   - 系统 LOGO 图片大小可在一定范围内调整

3. <font color = cornflowerblue>多媒体重定向</font>
   
   - 不依赖于 Windows Media Player 播放器，自带视频加速器实现视频重定向，最大支持 4k 视频重定向
   
   - AVI, WMV, FLV, MKV, MP4 等主流媒体格式

**<font color = Red>【安全可靠增强】</font>**

1. <mark>桌面水印增强</mark>
   
   - 输入 RGB 色，调整水印的颜色；

2. <mark>终端和用户绑定增强</mark>
   
   - TC 和用户绑定 MAC 地址免录入；
   
   - 移动终端和用户绑定；

3. <mark>USRKEY 登录认证增强</mark>
   
   - Ukey 登录 Windows 10 桌面（单点和非单点）；
   
   - 短域名数字证书；

4. <mark>桌面管理节点可靠性增强</mark>
   
   - LiteAD  AD 数据同步状态检测及数据不同步告警；
   
   - LiteAD  DHCP 双机一致性检查并告警；

### 华为桌面云突破虚拟桌面发展瓶颈

1. <font color = cornflowerblue>用户卓越体验</font>
   
   - 音质 PESQ 超过3.4；
   
   - 1080P 视频播放；
   
   - GPU 虚拟化，3D 应用无忧；
   
   - 友好的登录使用界面

2. <font color = cornflowerblue>管理员管理敏捷高效</font>
   
   - 统一的运维管理平台；
   
   - 八大辅助维护工具，可服务性提升
   
   - 分支机构统一管理

3. <font color = cornflowerblue>决策者业务安全可靠</font>
   
   - 覆盖接入、平台、网络、管理、数据的 E2E 安全保护
   
   - 完善的容灾能力，解决后顾之忧

### LiteAD: 轻量级敏捷交付

![](./屏幕截图%202022-11-16%20025151.png)

### FusionAccess R6 虚拟桌面规格

![](./屏幕截图%202022-11-16%20033634.png)

### ~ 应用场景

- 分支机构

- 桌面运营

- 云图形工作

- 云展厅

- 普通办公

- 公用客户端

- 安全办公

## 公有云解决方案 —— IaaS 服务介绍

### 华为云业务架构

![](./屏幕截图%202022-11-16%20034023.png)

### 华为云产品业务概览

![](./屏幕截图%202022-11-16%20034215.png)

### 计算类产品

1. <mark>弹性云主机  Elastic Cloud Server / ECS</mark>
   
   ![](./屏幕截图%202022-11-16%20131758.png)
   
   ![](./屏幕截图%202022-11-16%20131814.png)
   
   > 使用的资源池是共享的
   
   - <u>类型丰富</u>
     
     通用型 / 计算 I 型 / 计算 II 型 / 内存优化型
   
   - <u>大规格支持</u>
     
     CPU 最大32核，内存最大128 G
   
   - <u>镜像类型全</u>
     
     Windows / 各种 Linux
   
   - <u>网卡数量多</u>
     
     灵活多张网卡，支持内网外网网卡分开
   
   - <u>差异化云硬盘</u>
     
     通用 IO / 高 IO / 超高 IO / 系统盘 / 数据盘
     
     都支持差异化 SATA / SAS / SSD
   
   - <u>高安全</u>
     
     VPC / WAF / 漏扫 / Anti-DDOS
   
   - <u>高可靠</u>
     
     自动漂移 / 数据多副本 / 支持备份恢复
   
   - <u>高弹性</u>
     
     横向纵向弹性，灵活自动伸缩策略

2. <mark>专属云  Dedicated Cloud</mark>
   
   专属云是从物理上隔离的专属虚拟化资源池，在专属云内用户独享计算、存储和网络资源，并可在管理控制台统一管理；就像自建私有云一样，灵活使用专属云资源
   
   ![](./屏幕截图%202022-11-16%20133914.png)

3. <mark>弹性伸缩服务  Auto Scaling / AS</mark>
   
   弹性伸缩服务是根据用户的业务需求，通过策略自动调整其业务资源的服务。您可以根据业务需求自行定义弹性配置和策略，满足业务需求的同时，减少资源投入
   
   ![](./屏幕截图%202022-11-16%20134329.png)

4. <mark>镜像服务  Image Management Server / IMS</mark>
   
   镜像是弹性云主机实例可选择的运行环境模板，一般包括操作系统和预装的软件。通过镜像，您可以在弹性云主机实例上实现应用场景的快速部署。包括公有镜像、私有镜像
   
   ![](./屏幕截图%202022-11-16%20134712.png)
   
   用户选中自定义镜像后，到应用超市走商务流程，完成共享镜像产品上架。基于自定义镜像创建云主机；
   
   用户可以把自己在 region1 里的镜像复制到 region2、region3。

---

【**服务介绍**】

- <font color = cornflowerblue>ESC 弹性云主机</font>
  
  登录方式多样：NO VNC / RDP / SSH / 口令模式 / 整数模式
  
  规格变更，可对云主机进行规格变更：
  
  ![](./屏幕截图%202022-11-16%20133309.png)
  
  周期变更：可对云主机进行周期变更，按需转成套餐，下一分钟生效；套餐转成按需，下一小时生效
  
  ![](./屏幕截图%202022-11-16%20133339.png)

|      | ESC 弹性云主机                                   | DEC 专属云服务                          | AS 弹性伸缩                             | IMS 镜像                |
| ---- | ------------------------------------------- | ---------------------------------- | ----------------------------------- | --------------------- |
| 服务组件 | 虚拟私有云VPC、云硬盘、云监控、镜像服务、弹性带宽、弹性IP             | 弹性云主机、虚拟私有云、云硬盘、云监控、镜像服务、弹性带宽、弹性IP | 弹性云主机、弹性负载均衡、镜像、虚拟私有云、云监控           | 镜像、对象存储               |
| 购买计费 | 用户在线开通<br/>支持按需 (元/小时)、包月 (元/月)、包年 (元/年)    | 用户提交工单申请开通<br/>包月 (元/月)、包年 (元/年)   | 本身不收取费用，费用按使用资源情况计算；<br/>直接配置使用     | 产生自定义私有镜像时，按需收取对象存储费用 |
| 使用场景 | - 一般业务应用<br/>- 数据库运行<br/>- 大数据部署<br/>- 生物计算 | 银行、证券、保险等对安全有高要求的金融行业、大型国企等        | 电商、手游、企业网站等的分布式高并发集群密集计算型企业的大数据处理集群 | 通用场景                  |

### 存储类产品

1. <mark>云硬盘  Elastic Volume Service / EVS</mark>
   
   为华为云中的云主机提供块级别数据磁盘，满足用户对数据的高持久性和高性能的需求
   
   ![](./屏幕截图%202022-11-16%20135327.png)

2. <mark>云硬盘备份服务  Volume Backup Service / VBS</mark>
   
   云硬盘备份服务是一种提供基于云硬盘的备份服务；用户可为云硬盘创建备份，利用备份数据回滚云硬盘，以最大限度保证用户数据正确性和安全性
   
   ![](./屏幕截图%202022-11-16%20135642.png)
   
   后续规划中，用户可以设置自动备份策略，包括需要自动被封的云硬盘、备份时间窗口、备份周期与备份数据保留时长

3. <mark>对象存储服务  Object Storage / OBS</mark>
   
   一个基于对象的海量存储服务，为用户提供海量、低成本、高可靠、安全的数据存储能力
   
   ![](./屏幕截图%202022-11-16%20145010.png)

---

【**服务介绍**】

|      | EVS 云硬盘                                       | VBS 云硬盘备份                                                    | OBS 对象存储                                                   |
| ---- | --------------------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |
| 服务组件 | 云硬盘                                           | 云硬盘、云硬盘备份                                                    | 对象存储                                                       |
| 购买计费 | 自助开通，按需、套餐按需 (元/小时/GB)、包月(元/月/GB)、包年 (元/年/GB) | 计费方式:按备份存储的实际使用量计费，按小时计费，按天结算。公测期间免费。<br/>购买方式:直接在线使用云硬盘备份服务 | 按需（存储空间 元/小时；数据请求数元/千次或万次；流量 元/GB<br/>购买方式：直接在线开通对象存储服务    |
| 使用场景 | 通用场景                                          | 关键数据、核心业务，核心数据库，防止以下情况引起的数据损失：一是受黑客攻击或病毒入侵；二是数据被误删           | - 海量存储资源池<br/>- 静态网站托管<br/>- 大数据存储<br/>- 备份、归档<br/>- 网盘类业务 |

### 网络类产品

1. <mark>虚拟私有云  Virtual Private Cloud / VPC</mark>
   
   ![](./屏幕截图%202022-11-16%20145712.png)

2. <mark>弹性负载均衡</mark>
   
   通过将访问流量自动分发到多台弹性云主机，扩展应用系统对外的服务能力，实现更高水平的应用程序容错性能
   
   ![](./屏幕截图%202022-11-16%20150455.png)

---

【**服务介绍**】

|      | VPC 虚拟私有云                                                           | ELB 弹性负载均衡                |
| ---- | ------------------------------------------------------------------- | ------------------------- |
| 服务组件 | 子网、带宽、公网 IP、安全组、VPN                                                 | 弹性负载均衡                    |
| 购买计费 | 默认为用户开通一个；<br/>支持公网 IP 和带宽按需、包月、包年购买，用户自定义带宽大小；<br/>支持 VPN 按需（小时）购买 | 在线按需购买（元/小时）              |
| 使用场景 | 通用场景                                                                | 高并发访问的业务，通常在 WEB 网站类用的比较多 |

### 安全类产品

1. <mark>WEB 漏洞扫描  Web Scan</mark>
   
   租户通过安全服务 Console，开通网站漏洞扫描服务，人工触发扫描网站业面，发现网站的代码漏洞，提醒租户修复漏洞
   
   【**关键特性**】
   
   - 支持27种以上 Web 漏洞安全检测，覆盖 OWASP Top 10
   
   - 多达1000种第三方开源软件的漏洞检测以及未知漏洞 Oday 的检测
   
   - 覆盖600多种 Web 指纹以及主机指纹

2. <mark>WEB 应用防火墙</mark>
   
   Web 应用防火墙会对 HTTP 的请求进行异常检测，有效防止网页篡改、信息泄露、木马植入等恶意网络入侵行为
   
   ![](./屏幕截图%202022-11-16%20235128.png)
   
   【**关键特性**】
   
   - 业界支持 OS 类型最广的防病毒产品，多达17种不同的 Windows / Linux 系统
   
   - 突破传统防病毒产品的局限性，提供深度的安全防护，为租户提供全方位的安全保护，包括
     
     - 防恶意软件
     
     - Web 信誉
     
     - 防火墙
     
     - 入侵防御
     
     - 完整性监控
     
     - 日志审计

3. <mark>Anti-DDOS流量清洗</mark>
   
   ![](./屏幕截图%202022-11-16%20235403.png)

---

【**服务介绍**】

|      | WEB 漏洞扫描        | WEB 应用防火墙 | Anti-DDOS 流量清洗      |
| ---- | --------------- | --------- | ------------------- |
| 服务组件 | WEB 漏洞扫描        | WAF       | Anti-DDOS 流量清洗      |
| 购买计费 | 免费              | 免费        | 免费                  |
| 使用场景 | 对外提供 WEB 服务的云主机 | WEB 应用    | 有公网 IP 的HWS 线上业务云主机 |

### 管理类产品

1. <mark>云监控服务  Cloud Eye</mark>
   
   云监控服务是基础管理服务之一，在 IaaS 层提供监控告警功能的可扩展高性能服务

2. <mark>IAM 统一身份认证  Identity and Access Management</mark>
   
   认证中心就是将用户的认证信息进行集中管理，其中包括账户的基本信息 (账户名登录手机，登录邮箱等) 以及账户的访问密钥，并且可修改登录邮箱、手机、密码以及管理访问密钥
   
   ![](./屏幕截图%202022-11-17%20000257.png)

---

【**服务介绍**】

|      | 云监控服务                                                | IAM 统一身份认证 |
| ---- | ---------------------------------------------------- | ---------- |
| 服务组件 | 云监控服务                                                | IAM        |
| 购买计费 | 公测期间免费，需购买，租户自助开通                                    | 不收费，默认开通   |
| 使用场景 | 对用户已有 HWS 资源进行实时监控，实时告警，根据 HWS 上线对接的服务多少来给用户提供多少服务监控 | 通用场景       |

# 云计算主流技术

讲述了云集的主流技术，介绍了虚拟化优势以及虚拟机的优势，讲述了 Hypervisor 的作用；讲述了容器的概念，容器和虚拟化的区别

## 虚拟化  Virtualization

虚拟化  Virtualization 的含义很广泛；将任何一种形式的资源抽象成另一种形式的技术都是虚拟化；虚拟化是资源的逻辑表示，其不受物理限制的约束

![](./屏幕截图%202022-11-17%20003416.png)

<mark>**虚拟化中的几个重要概念**</mark>

![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-17%20004039.png)

- Guest OS: 运行在虚拟机之上的 OS

- Guest Machine: 虚拟出来的虚拟机

- Hypervisor: 虚拟化软件层 / 虚拟机监控机 (Virtual Machine Monitor, VMM)

- Host OS: 运行在物理机之上的 OS

- Host Machine: 物理机

## 虚拟化的特点

1. <font color = cornflowerblue>分区</font>
   
   在单一物理服务器上同时运行多个虚拟机

2. <font color = cornflowerblue>隔离</font>
   
   在同一服务器上的多个虚拟机之间相互隔离

3. <font color = cornflowerblue>封装</font>
   
   整个虚拟机执行环境封装在独立文件中，可以通过移动文件的方式来迁移该虚拟机

4. <font color = cornflowerblue>相对于硬件独立</font>
   
   虚拟机无需修改，即可在任何服务器上运行

---

> **云计算 VS 虚拟化**
> 
> 虚拟化是实现云计算的技术支撑手段之一，但并非云计算的核心关注点；
> 
> 虚拟化技术是云计算在 IaaS 层具有商用价值的基础

## 虚拟化的优势

1. 操作系统与物理服务器分离

2. 易于迁移、扩展、资源整合

3. 标准化的虚拟硬件

4. 由一系列文件组成，易于保护

| 性能     | 虚拟化前                        | 虚拟化后                                           |
| ------ | --------------------------- | ---------------------------------------------- |
| 资源利用率  | 每台主机一个操作系统，系统的资源利用率低        | 主机与操作系统不一一对应，按需分配使用，系统的资源利用率高                  |
| 独立性    | 软硬件紧密结合，硬件成本高昂且不够灵活         | 操作系统和硬件不相互依赖，虚拟机独立于硬件，能在任何硬件上运行                |
| 程序运行效率 | 同一台主机上同时运行多个程序容易产生冲突，运行效率较低 | 管理操作系统和应用程序被封装成单一个体，不同个体间不冲突；同一台机器上运行同一个程序，效率高 |
| 安全性    | 安全性较差                       | 强大的安全和故障隔离                                     |

## 虚拟化架构

<mark>根据在整个系统中的位置不同</mark>

![](./屏幕截图%202022-11-17%20010009.png)

|     | 寄居虚拟化                                      | 裸金属虚拟化                                                    | 操作系统虚拟化          | 混合虚拟化                         |
| --- | ------------------------------------------ | --------------------------------------------------------- | ---------------- | ----------------------------- |
| 优点  | 简单、易于实现                                    | 虚拟机不依赖于操作系统；支持多种操作系统，多种应用                                 | 简单、易于实现；管理开销非常低  | 相对于寄居虚拟化架构，没有冗余，性能高；可支持多种操作系统 |
| 缺点  | 安装和运行应用程序依赖于主机操作系统对设备的支持；<br/>管理开销较大，性能损耗大 | 虚拟层内核开发难度大                                                | 隔离性差，多容器共享同一操作系统 | 需底层硬件支持虚拟化扩展功能                |
| 厂商  | VMware Workstation                         | WMware ESXServer<br/>Citrix XenServer<br/>华为 FusionSphere | Virtuozzo        | Redhat KVM                    |

<mark>根据 Hypervisor 的实现方式和所处位置</mark>

![](./屏幕截图%202022-11-17%20020228.png)

## 虚拟机与 VMM 的关系

虚拟机  Virtual Machine 是由虚拟化层提供的高效、独立的虚拟计算机系统，其皆拥有自己的虚拟硬件（CPU, 内存）

通过虚拟化层的模拟，虚拟机在上层软件看来，就是一个真实的机器；这个虚拟化层一般称为虚拟机监控器  Virtual Machine Monitor / VMM，也称 Hypervisor

---

### VMM 功能

1. **<font color = cornflowerblue>虚拟资源</font>**
   
   VMM 利用底层硬件资源来构建一个包含虚拟 CPU、内存和外设等的虚拟环境；
   
   在这个环境中，Guest OS 认为自己运行在一台真实的计算机上，并唯一拥有这台 “虚拟” 机器上的所有资源

2. **<font color = cornflowerblue>虚拟环境的调度</font>**
   
   VMM 可以同时构建多个虚拟机环境，从而允许多个 Guest OS 并发执行，VMM 利用一套策略来有效的调度资源

3. **<font color = cornflowerblue>虚拟化环境的管理接口</font>**
   
   VMM 提供一组完备的管理接口，来支持虚拟环境的创建、删除、暂停和迁移等功能；
   
   上层的管理程序通过调用 VMM 提供的管理接口，为用户提供管理界面

## 容器

容器是操作系统内核自带能力，是基于一些 Linux 内核的特性构建而成，Docker 并没有重新发明这些特性

> - caroups: 主要做资源控制
> 
> - namespaces: 主要做访问隔离

<mark>LXC (Linux Containers) tools</mark>

Linux Container 容器是一种内核虚拟化技术，可以提供轻量级的虚拟化，以便隔离进程和资源

<mark>已有的容器技术</mark>

- Docker

- Rocket

> Docker 并没有发明容器，更像是容器的前端和外围工具
> 
> Docker 核心在于实现应用与运行环境整体打包以及打包格式统一
> 
> Docker 并不是容器技术的唯一选择

【**Docker VS Container**】

1. 传统 Container
   
   - 缺少自动化、使用复杂
   
   - 用法与平台耦合性高、应用范围窄、用户限制大
   
   - 只解决了 Run (运行)，没有解决 Build (创建) 和 Ship (传输)
   
   - 各个容器的实现方式千差万别，缺省统一的标准

2. Docker
   
   - 提供了 Portable (便携) 的标准并且提供了实现
   
   - 基于该标准的容器 Build 和 Ship 机制

### Docker 容器技术概述

Docker 是一个开源的应用容器引擎，让开发者可以打包应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上

基于 Go 语言开发，遵从 Apache2.0 协议开源

![](./屏幕截图%202022-11-17%20020228.png)

<mark>技术主要特点</mark>

- 快
  
  运行时的性能可以获取极大提升

- 灵活
  
  将应用和系统 “容器化”，不添加额外的操作系统，支持跨 OS 部署

- 轻便
  
  你会拥有足够的 “操作系统” (容器)，仅需添加或减小镜像即可，每台服务器可部署 100~1000 个实例

- 廉价
  
  版本开源免费，低成本

- 生态
  
  业界（微软、亚马逊、IBM、Cisco）主流 IT 厂商逐步使用 Docker 容器技术

<mark>技术使用场景</mark>

- 简化配置

- 代码流水线管理

- 提高开发效率

- 隔离应用

- 快速部署

- 支持多组环境

- 整合服务器，降低资源成本

<mark>Docker 解决的问题</mark>

1. 应用环境管理复杂
   
   OS, 中间件，各种 APP

2. 减化环境管理复杂度，减化应用实例部署工作，将应用打成 Image 部署
   
   Web 应用，DB 应用，Hadoop 应用，消息对列

3. 提供分发和标准化管理

### Docker 技术架构

1. <font color = cornflowerblue>Docker 三组件</font>
   
   - Docker Client: 用户界面，支持用户与 Docker Daemon 之间通信
   
   - Docker Daemon (守护进程): 运行于主机上，处理服务请求
   
   - Docker Registry (注册):支持拥有公有与私有访问权限的Docker 容器镜像仓库

2- <font color = cornflowerblue>Docker 三要素</font>

- Docker Containers: 负责应用程序的运行，包括操作系统、用户添加的文件以及元数据

- Docker Images: 构建容器的只读模板，用来运行 Docker 容器

- DockerFile: 文件指令集，用来说明如何自动创建 Docker 镜像

# 服务器虚拟化 —— 计算资源

## FusionCompute

1. **<font color = cornflowerblue>什么是 FusionCompute</font>**
   
   ![](./屏幕截图%202022-11-17%20100849.png)
   
   老版本的 FusionCompute
   
   FusionCompute 是云操作系统软件，主要负责对虚拟资源、业务资源、用户资源的集中管理；它采用统一的接口，对这些虚拟资源进行集中调度和管理，从而降低业务的运行成本，保证系统的安全性和可靠性，协助运营商和企业构筑安全、绿色、节能的云数据中心能力

2. **<font color = cornflowerblue>FusionCompute 定位</font>**
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-17%20101111.png)

   
   - <u>**虚拟资源调度**</u>
     
     集群资源调度
   
   - <u>**安全性**</u>
   
   - <u>**可扩展性**</u>
     
     提供上层接口 API
   
   - <u>**VRM 可以为上层提供接口，动态管理下面的服务器**</u>
     
     需要什么资源，VRM 会告诉 CNA 需要什么

3. **<font color = cornflowerblue>FusionCompute 架构</font>**
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-17%20104850.png)

   
   - ***CNA (ComputingNode Agent)***: 计算节点代理
   
   - ***VNA 虚拟节点代理***，部署在 CNA 上，实施计算、存储、网络的虚拟化的配置管理
   
   - ***VRM (Virtual Resource Manager)***: 虚拟资源管理

4. **<font color = cornflowerblue>特点</font>**
   
   - <mark>统一虚拟化平台</mark>
     
     - 支持虚拟化资源按需分配
     
     - 支持多操作系统
     
     - QoS 保证资源分配，隔离用户问影响
       
       预留【最小值】；限制【最大值】；份额【比例】
   
   - <mark>支持多种硬件设备</mark>
     
     - FusionCompute 支持基于 x86 硬件平台的多种服务器和兼容多种存储设备，可供运营商和企业灵活选择
   
   - <mark>大集群</mark>
     
     - 单个集群最大可支持128个主机，3000台虚拟机
   
   - <mark>自动化调度【集群调度】</mark>
     
     - 通过 IT 资源调度、热管理、能耗管理等一体化拉通，降低维护成本
     
     - 自动检测服务器或业务的负载情况，对资源进行智能调度，均衡各服务器及业务系统负载，保证系统良好的用户体验和业务系统的最佳响应
   
   - <mark>完善的权限管理</mark>
     
     - FusionCompute 可根据不同的角色、权限等，提供完善的权限管理功能，授权用户对系统内的资源进行管理
   
   - <mark>丰富的运维管理</mark>
     
     - 支持黑匣子
     
     - 支持自动化健康检测
     
     - 支持全 Web 化的界面

5. **<font color = cornflowerblue>安装</font>**
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-17%20111041.png)

   
   实际需要内存至少16g

## 使用 iso 方式安装 CNA

## VRM 简介

1. **<mark><font color = red>VRM</font></mark>**
   
   VRM 是 FusionCompute 系统的管理单元，一般运行在虚拟机上，能够对系统的虚拟资源、业务资源、用户资源进行集中管理，为管理员提供统一的维护操作接口；

2. **<mark><font color = red>FusionCompute 系统管理</font></mark>**
   
   使用 web 浏览器输入 VRM 节点的浮动 IP 地址登录 FusionCompute
   
   ![](./屏幕截图%202022-11-26%20013648.png)
   
   【**技术特点**】
   
   - 遵从账户-角色模型
     
     每个角色分权：*具体到创建虚拟机、创建卷等操作*；
     
     分域：*按逻辑集群维度*
   
   - 支持账户、角色的生命周期管理
   
   - 支持账户口令复杂度策略管理，包括密码长度、有效期等

3. **<mark><font color = red>计算池</font></mark>**
   
   - <u>**集群是什么**</u>
     
     服务器集群就是指将很多服务器**集中起来一起进行同一种服务**，在客户端看来就像是只有一个服务器；
     
     集群可以利用多个计算机进行并行计算从而获得很高的计算速度；也可以用多个计算机做备份，从而使得任何一个机器坏了整个系统还是能正常运行；
   
   - <u>**集群管理**</u>
     
     ![](./屏幕截图%202022-11-26%20025017.png)
   
   - <u>**主机管理**</u>
     
     ![](./屏幕截图%202022-11-26%20025401.png)

4. **<mark><font color = red>集群的优势</font></mark>**
   
   - ***HA***
     
     - 支持主机、虚拟平台、虚拟机内部多种故障场景的检测和虚拟机恢复
     
     - 支持集中控制 HA 和集群自治 HA 两种机制，可自选
     
     - 可设置 HA 心跳消息的网络平面，降低网络压力
     
     - 多种故障判断机制，避免漏判、误判故障
     
     - 支持共享存储与本地存储虚拟机 HA
     
     **对于用户而言**，大幅度提升故障恢复速度，降低业务中断时间、保障业务连续性、实现一定的系统自维护
   
   - ***DRS***
     
     **动态资源调度**
     
     <font color = cornflowerblue>【技术特点】</font>
     
     - 根据调度策略自动实现集群内虚拟机负载<u>**相对均衡**</u>
     
     - 调度算法合理，兼顾虚拟机负载**变化趋势**，避免了虚拟机在主机上来回震荡迁移
     
     - 独有的调度基线设置功能，避免虚拟机无用迁移
     
     - 可针对特殊要求的虚拟机设置例外不调度或手动调度
     
     - 支持管理员**即时**手动调度和按策略周期性自动调度
     
     - 可按每天、每周、每月选择时间段精确设置调度策略
     
     <font color = cornflowerblue>【应用场景 & 客户价值】</font>
     
     - 适用于虚拟机的业务负载具有较明显的**连续性波峰和波谷变化**，用户需要获取更好性能体验的场景
     
     - 通过动态调度虚拟机，使各主机的资源利用率更加均衡，各主机的计算能力发挥更加充分
     
     - 各虚拟机上的业务系统运行的效率更高
   
   - ***DPM***
     
     **分布式电源管理**
     
     ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-26%20032005.png)
     
     <font color = cornflowerblue>【技术特点】</font>
     
     - 系统根据用户设定的 DPM 策略，将**低负载**主机上的虚拟机迁移走并对该主机**下电**、对于**负载超过设置阈值**的主机，系统智能选择**一定数量的主机对其上电**，以实现集群内主机整体的负载分担
     
     - 可智能选择对1台还是多台主机同时进行上、下电
     
     - DPM DRS 同时考虑，**避免两种功能相互影响**
     
     - 可按每天、每周、每月时间段精确设置调度策略
     
     <font color = cornflowerblue>【应用场景 & 客户价值】</font>
     
     - 适用于虚拟机的业务负载具有较明显的**连续性波峰和波谷变化**，用户需要节省能耗的场景
     
     - 在保证业务系统正常运行的前提下，在业务负荷波谷阶段将虚拟机迁移整合到部分主机上，将空闲出来的主机智能下电，节省了系统能耗；
       
       在业务负载波峰阶段对下电的主机进行上电，以保证虚拟机的运行效率和业务体验
   
   - ***内存复用***
     
     - 内存复用  是指在服务器物理内存一定的情况下，通过综合运用内存复用单项技术对内存进行**分时复用**；
       
       通过内存复用，使得虚拟机内存规格综合**大于**服务器规格内存综合，提高服务器中虚拟机密度
     
     - **智能内存复用**可提升内存资源的利用率，帮助用户节省内存采购成本，延长物理服务器升级内存的周期
     
     - FusionSphere 支持以下内存复用技术
       
       1. <font color = cornflowerblue>内存气泡</font>
          
          系统主动回收虚拟机暂时不用的物理内存，分配给需要复用内存的虚拟机；
          
          内存的回收和分配均为**系统动态执行**，虚拟机上的应用无感知；整个物理服务器上的所有虚拟机使用的分配内存总量不能超过该服务器的物理内存总量
       
       2. <font color = cornflowerblue>内存交换</font>
          
          **将外部存储虚拟成内存给虚拟机使用**，将虚拟机上暂时不用的数据存放到外部存储上；
          
          系统需要使用这些数据时，再与预留在内存上的数据进行交换
       
       3. <font color = cornflowerblue>内存共享</font>
          
          多台虚拟机共享数据内容为零的内存页
   
   - ***NUMA***
     
     Non Uniform Memory Access Architecture
     
     - 物理服务器**提高性能**的一种技术，将物理服务器的 CPU 和内存资源分到多个 node 上，每个 node 内部可以完全独立工资；
       
       **Node 内的内存访问效率最高**，如果一台 VM 的 VCPU 跨 Node 访问 memory 的话，必定会导致内存访问延迟的增加，NUMA 保证了一个 VM 上的 VCPU 尽量分配到同一个 node 中的 PCPU 上
   
   - ***I / O 环***
     
     - I / O 环适配功能主要用来**提升**大块多队列类型的 IO密集型业务的 I / O 性能
       
       大块 (44K 以上) 多队列 (32队列深度以上) 的 I / O 请求因为分包和 I / O 环通道较窄导致存储性能无法充分发挥，用户可通过开启 I / O 环适配功能，提升 I / O 性能
     
     - 虚拟机 I / O 环适配以**集群**为单位进行设置，若虚拟机使用 NAS 存储、虚拟机本地存储或者虚拟化 SAN 存储的磁盘时，开启虚拟机 I / O 环适配还需要开启主机虚拟机存储 I / O 环适配
     
     - 主机虚拟机存储 I / O 环适配以集群为单位进行设置，开启后需要重启主机才能生效，且 Domain 0 内存大小需要在原来基础上增加 2GB，预留 VCPU 个数与最大 VCPU 个数需要在原有基础上增加2个
       
       如果主机操作系统安装在 U 盘或者 SAN 存储上，则主机不支持开启主机虚拟化存储 I / O 环适配
   
   - ***IMC***
     
     - 设置集群的 IMC 策略，使虚拟机可以**在不同 CPU 类型的主机之间进行迁移**
     
     - 目前 IMC 策略**仅支持 INTEL 不同型号 CPU** 的热迁移，其他厂商的 CPU 不能配置该功能
     
     - IMC 可以确保**集群内的主机向虚拟机提供相同的 CPU 功能集**，即使这些主机的实际 CPU 不同，也不会因 CPU 不兼容而导致迁移虚拟机失败
     
     - 设置集群 IMC 策略时，如果集群中有主机或虚拟机，则必须满足下面条件
       
       1. 集群下主机的 CPU 功能集必须**等于或高于**设置的目标基准功能集
       
       2. 集群下运行或休眠状态的虚拟机 CPU 功能集必须**等于或低于**目标基准功能集；
          
          如果存在不满足条件的虚拟机，需要将该虚拟机关机或迁移出该集群后设置
   
   - ***计算资源调度***

## CNA 简介

1. **<font color = cornflowerblue>CNA 定义</font>**
   
   - ComputingNode Agent
     
     计算节点代理
     
     部署在计算节点上，用于管理本计算节点上的虚拟机以及与对应虚拟磁盘的挂接
   
   - CNA 主要提供**以下功能**
     
     - 提供虚拟计算功能
     
     - 管理计算节点上的虚拟机
     
     - 管理计算节点上的计算、存储、网络资源
   
   - <mark>FusionCompute  CNA 架构</mark>
     
     ![](./屏幕截图%202022-11-26%20132816.png)

2. **<font color = cornflowerblue>CNA 主机常用操作</font>**
   
   - <u>**添加主机**</u>
     
     管理员通过 FusionCompute，在集群中添加主机
     
     ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-26%20133627.png)
   
   - <u>**移动主机**</u>

3. **<font color = cornflowerblue>绑定接口</font>**
   
   - <u>**存储接口**</u>
     
     通过 FusionCompute，在主机中添加存储接口，实现主机**与存储设备对接**；添加多个存储接口，可以实现存储的多路径传输；
     
     每个主机最多可添加**四个**存储接口；在较大规模的部署环境中，一般都要求存储接口单独划分，做到存储平面与其它平面的隔离
   
   - <u>**业务接口**</u>
     
     - 通过 FusionCompute，在主机中添加业务管理接口；业务管理接口是用于承载一些**特殊业务流量**的系统接口，这些特殊业务包括热迁移虚拟机、虚拟机主机容灾、虚拟化 SAN 存储心跳检测等
     
     - 主机添加成功后，在未配置业务管理接口的情况下，系统默认使用管理接口进行上述特殊业务的流量管理，与管理流量共用同一接口；启用相关功能的业务管理接口后，将使用业务管理接口进行该功能的流量管理
   
   - <u>**绑定接口**</u>
     
     如果主机网卡使用 iNIC 智能网卡，建议将主机的上行链路网口绑定，否则会影响端口组的广播抑制功能；FusionCompute 提供多种绑定模式以适应不同的长江需求
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-26%20142711.png)

4. **<font color = cornflowerblue>维护模式</font>**
   
   ![](./屏幕截图%202022-11-26%20143232.png)
   
   该任务指导管理员通过 FusionCompute，设置主机进入维护模式；主机进入维护模式后，可以将该主机与整个系统隔离开来，以便于在不影响系统业务的情况下，在该主机上执行部件更换或下电、重启等维护的操作

# 服务器虚拟化——存储资源管理

## 存储资源类型

1. **<mark><font color = red>存储虚拟化</font></mark>**【统一标准格式的存储格式】
   
   - 存储虚拟化是将存储设备抽象为数据存储，虚拟机在数据存储中作为一组文件存储在自己的目录中
   
   - 数据存储是**逻辑容器**，类似于文件系统，它将各个存储设备的特性隐藏起来，并提供一个**统一的模型**来存储虚拟机文件；
   
   - 存储虚拟化技术可以更好的管理虚拟基础架构的存储资源，使系统大幅提升存储资源利用率和灵活性，提高应用的正常运行事件

2. **<mark><font color = red>虚拟化、非虚拟化存储</font></mark>**
   
   - ***虚拟化存储***
     
     存储虚拟化技术可以将不同存储设备进行格式化，屏蔽存储设备的能力、接口协议等差异，将各种存储资源转化为**统一管理**的数据存储资源
   
   - ***非虚拟化存储***
     
     基于逻辑卷管理，较虚拟化存储有更高的性能，速度更快，效率更高；但功能少，对快照、精简配置等支持的程度没有存储虚拟化高
     
     > *<u>快照</u>*
     > 
     > 冻结虚拟机当前磁盘状态
   
   - ***裸设备映射***
     
     将物理裸设备直接映射给虚拟机，虚拟机磁盘能够处理 SCSI 命令；适用于关键行业务场景，如数据库业务；
     
     该类型的数据存储不支持虚拟化存储的高级功能，只能创建一个磁盘；

3. **<mark><font color = red>华为云计算存储模型</font></mark>**
   
   - ***存储资源***
     
     存储资源表示**物理存储设备**；e.g.    IP SAN, Advanced SAN, NAS 等
   
   - ***存储设备***
     
     存储设备表示存储资源中的**管理单元**，类似 LUN, Advanced SAN 存储池, NAS 共享目录等；
     
     <u>**一个存储资源可以有多个存储设备**</u>
   
   - ***数据存储***
     
     - 数据存储表示系统中可管理、操作的**存储逻辑单元**
     
     - 一个数据存储和一个存储设备对应
     
     - 数据存储承载了具体的虚拟机业务，e.g.    创建磁盘等

4. **<mark><font color = red>存储资源</font></mark>**
   
   - <u>FusionCompute 的存储资源包括</u>
     
     IP SAN, FC SAN, Advanced SAN, FusionStorage 和 NAS
     
     - ***IP SAN***
       
       通过 iscsi 链路和主机建立连接
     
     - ***FC SAN***
       
       通过光纤通道和主机连接的，主机连接 SAN 设备后可以扫描存储设备 (LUN)
     
     - ***Advanced SAN***
       
       通过 SMI-S 接口扫描、管理磁盘
     
     - ***FusionStorage***
       
       通过其管理结点提供的接口管理存储的
     
     - ***NFS***
       
       通过 NFS 协议扫描和挂载共享目录
   
   - <u>主机访问存储资源</u>
     
     - 先需要添加存储资源
     
     - 再选定主机并关联存储资源

5. **<mark><font color = red>存储资源使用对比</font></mark>**
   
   ![](./屏幕截图%202022-11-21%20223900.png)
   
   - **<u>存储卸载</u>**
     
     指将部分存储操作（<u>模板部署、删除清零等操作</u>）下移到存储侧进行，这样做可以不浪费主机侧资源，同时也可以提升操作效率
   
   - **<u>虚拟化</u>**
     
     对于 LUN 或者本地磁盘，在不支持虚拟化的场景不能支持快照，链接克隆等高级功能，但是所创建的卷具有很好的性能；
     
     虚拟化后的数据存储，支持各种高级功能，卷格式也支持多种，但是性能低于非虚拟化的存储设备；

6. <mark>**<font color = red>FusionCompute 中的存储资源类型</font>**</mark>
   
   根据使用方式
   
   - ***本地磁盘***
     
     通常情况下是指使用服务器本地的磁盘资源，经过 RAID 化后提供给虚拟化平台进行使用；
     
     此类使用方便，速度相对较慢，无共享框架，无跨服务器的冗余机制；
   
   - ***SAN 设备    Storage Area Network***
     
     ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-21%20225612.png)

     
     - 主机、存储设备可以独立扩展
     
     - SAN: 存储区域网络，提供主机和存储系统之间数据传输，网络内部数据传输的速率快
     
     - 存储容量利用率高
     
     ---
     
     IP-SAN
     
     - 以 TCP / IP 协议为底层传输协议，采用以太网作为承载介质构建起来的存储区域网络架构；
     
     - 实现 IP-SAN 的典型协议是 iSCSI，它定义了 SCSI 指令集在 IP 中传输的封装方式；
     
     ---
     
     SAN 架构组网特点
     
     - 共享框架，为热迁移，HA 等特性提供了共享存储资源
     
     - SAN 架构组网通常位于业务网络后端，数据可靠性和隔离性好
     
     - 无需服务器本地进行存储指令处理，效率高；性能优于本地磁盘
   
   - ***NAS 设备    Network Attached Storage***
     
     ![](./屏幕截图%202022-11-22%20002628.png)
     
     网络附加存储，是一种将分布、独立的数据进行整合，集中化管理，以便于对不同主机和应用服务器进行访问的技术
     
     ![](./屏幕截图%202022-11-22%20003235.png)
     
     ---
     
     NAS 架构特点
     
     - 默认支持虚拟化数据存储
     
     - 支持磁盘精简分配
     
     - 支持快照等高级特性
   
   - ***AdvanceSAN***
     
     - Advanced SAN 是一种**特殊的 IP-SAN**，兼容华为 OceanStor 系列存储
     
     - Advanced SAN 与 VIMS 不同的是，在创建虚拟机磁盘时创建的是 LUN，并与虚拟机进行绑定
     
     - Advanced SAN **作为虚拟机的磁盘使用**
     
     - 在 Advanced SAN V3 存储中创建的磁盘，物理设备需要一部分空间用以保存元数据，从而会带来一些空间损耗
   
   - ***FusionStorage***
     
     FusionStorage 是一款可**大规模横向扩展**的存储产品，通过存储系统软件将标准 X86 服务器的本地存储资源组织起来，构建**全分布式存储池**，实现一套存储系统向上层应用提供块、文件和对象三种存储服务，满足结构化、非结构化等**多类型数据存储需求**。是超<u>**融合架构的典型产品**</u>，可以与 FusionSphere 产品一起搭配使用；
     
     - 全分布式；统一管理；标准硬件；面向未来；
     
     - ***SDC***
       
       软件定义存储
       
       软件定义的全融合云存储，敏捷云转型
       
       ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-22%20005016.png)
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-21%20225210.png)


7. **<mark><font color = red>数据存储</font></mark>**
   
   - 数据存储是 FusionCompute 对存储资源上的存储单元进行的**统一封装**；存储资源封装成数据存储并与主机关联后，就能够进一步创建出若干虚拟磁盘，供虚拟机使用；
     
     ![](./屏幕截图%202022-11-22%20021039.png)
   
   - 数据存储需要创建在<u>**指定的**</u>存储设备上，且一个存储设备只能创建一个数据存储；
   
   - 数据存储和主机关联，为主机提供资源，<u>**数据存储可以关联到多个主机**</u>，一个主机也可以使用多个数据存储
   
   - <u>**数据存储的使用**</u>
     
     - 存储设备必须被添加为数据存储才能被使用
     
     - 数据存储可用于存放虚拟机磁盘、快照文件
     
     - 数据存储的大小依赖于存储设备的大小

## 虚拟机磁盘类型

1. **<font color = cornflowerblue>普通磁盘</font>**
   
   只能单个虚拟机使用

2. **<font color = cornflowerblue>共享磁盘</font>**
   
   可以绑定多个虚拟机使用

3. **<font color = cornflowerblue>虚拟机磁盘配置模式</font>**
   
   - *普通延迟置零*
     
     直接创建，不立即格式化，需要使用时才进行格式化
   
   - *普通*
     
     创建并且格式化，创建速度没有普通延迟置零快
   
   - *精简*
     
     创建并且格式化，但是给的磁盘正在容量根据设备使用情况分配

4. **<font color = cornflowerblue>FusionCompute 创建磁盘流程</font>**
   
   - 选择 ”存储池“；进入 ”存储池“ 页面
   
   - 在左侧导航树，选择 ”站点名称“ >> ”数据存储名称“；显示 “入门” 页签
   
   - 单击 “磁盘”；显示磁盘信息列表
   
   - 单击 “创建磁盘”；弹出 “创建磁盘” 对话框，如图所示
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-22%20023559.png)

   
   > <u>**磁盘模式**</u>
   > 
   > - <u>从属</u>
   >   
   >   永久写入；可以做快照
   > 
   > - <u>独立-持久</u>
   >   
   >   永久写入；不可以做快照
   > 
   > - <u>独立-非持久</u>
   >   
   >   临时写入；断电重启等数据小时，不可以做快照

## 磁盘和存储的关联

1. **<mark><font color = red>RAID 与 LUN 间的关系</font></mark>**
   
   - RAID 由几个硬盘组成，从整体上看相当于由多个硬盘组成的一个大的物理卷;
   
   - 在物理卷的基础上可以按照指定容量创建一个或多个逻辑单元，这些逻辑单元称作 **LUN**，可以作为映射给主机的基本块设备；
   
   ![](./屏幕截图%202022-11-22%20030614.png)

2. **<mark><font color =red>创建 RAID 组与逻辑卷</font></mark>**
   
   ![](./屏幕截图%202022-11-22%20030831.png)

3. **<mark><font color = red>Pool & Volume & LUN</font></mark>**
   
   - ***storage Pool***
     
     即存储池，存放存储空间资源的容器，所有应用服务器使用的存储空间都来自于存储池；
   
   - ***Volume***
     
     即卷，存储系统内部管理对象；
   
   - ***LUN***
     
     可以直接映射给主机读写的存储单元，是 Volume 对象的对外体现；
   
   ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-22%20031650.png)


## 存储资源创建流程

1. **<font color = cornflowerblue>本地存储、裸设备映射存储</font>**
   
   扫描存储设备  >>  添加数据存储  >>  创建磁盘

2. **<font color = cornflowerblue>IP SAN, FC SAN, Advanced SAN, NAS, FusionStorage</font>**
   
   向站点添加存储资源  >>  添加数据存储  >>  创建磁盘

3. **<font color = cornflowerblue>手动添加主机存储接口</font>**
   
   - FusionCompute 中，选择 “计算池“；进入页面；
   
   - 左侧导航，选择 ”站点名称“  >>  集群文件夹名称  >>  集群名称  >>  主机名称；显示 ”入门“ 页签；
   
   - 选择 ”配置  >>  系统接口  >>  添加存储接口”；进入 “添加存储接口” 页面；
   
   ![](./屏幕截图%202022-11-22%20032527.png)
   
   - 添加存储接口
   
   ![](./屏幕截图%202022-11-22%20032613.png)
   
   - 在列表中选择该主机连接存储平面的网卡所对应的网口，单击 “下一步”
   
   - 网口名称 "PORTX" 对于主机的物理网口 "ethX"；
   
   - 进入 ”连接设置“ 页面
   
   ![](./屏幕截图%202022-11-22%20032804.png)

# 服务器虚拟化——网络资源管理

## 网络基础知识

1. **<mark><font color = red>网络世界的法律  >>  OSI 模型 / TCP/ IP 模型</font></mark>**
2. 
   ![](./屏幕截图%202022-11-22%20034438.png)

   ![](./屏幕截图%202022-11-22%20102449.png)


3. <mark>**<font color = red>网络层</font>**</mark>

   ![](./屏幕截图%202022-11-22%20103044.png)

   
   > 每一个层面互不交流

4. **<mark><font color = red>绕不开的二层和三层</font></mark>**
   
   ![](./屏幕截图%202022-11-22%20103333.png)

   
   不管是 ATM 网络、SDH 网络，还是以太网络，统一发送到网络层，都是使用相同的 IP 等其他协议

5. **<mark><font color = red>报文封装 / 从数据封装理解二层三层关系</font></mark>**
   
   ![](./屏幕截图%202022-11-22%20103656.png)

   
   > ***TCP***
   > 
   > 传输控制协议，可以保证协议可靠性；
   > 
   > 三次握手来保证以及字段中的 seq, ack；
   > 
   > e.g.    
   > 
   > A: seq = a
   > 
   > B: seq = b, ack = a + 1
   > 
   > 传输层报文互相确认可靠

6. **<mark><font color = red>通讯方式——单播</font></mark>**
   
   > <u>**ipv4 里传输报文分为三种**</u>
   > 
   > - 单播
   > 
   > - 广播
   > 
   > - 组播
   
   *一个人对一个人发送*

7. **<mark><font color = red>通讯方式——广播</font></mark>**
   
   相当于**群发**消息；也就是说，范围性，不管要不要，广播域内都会收到；
   
   <u>**某种意义上，二层网络就好比一个大的广播域**</u>
   
   一些缺点：
   
   - 安全性不足
   
   - 对于中间转发的设备而言，压力比较大
     
     因为交换设备收到广播报文，就进行复制然后分发给其他的所有接口；
   
   - 一个虚拟网络，有很多虚拟机，还有各种业务；每个业务每个虚拟机都有可能发送广播，接受太多可能会影响性能；
   
   - 即【安全性；网络效率；广播风暴】
   
   ---
   
   如何解决：
   
   ***VLAN  虚拟局域网***
   
   ![](./屏幕截图%202022-11-22%20111505.png)

   
   ![](./屏幕截图%202022-11-22%20111533.png)

   
   则相同组，也就是相同 VLAN，可以传播广播报文，可以通信；不同 VLAN，无法传播广播报文，无法通信；
   
   【**VLAN 原理**】
   
   VLAN 通过对传统的数据帧添加 tag 字段来实现；
   
   ![](./屏幕截图%202022-11-22%20112052.png)

   
   【**VLAN 链路**】
   
   两种链路类型
   
   - 普通链路  Access Link
   
   - 中继链路  Trunk Link
   
   【**相关接口类型**】
   
   - Access 接口
   
   - Trunk 接口
   
   - Hybrid 接口
   
   【**各类型接口对数据帧的处理方式**】
   
   ![](./屏幕截图%202022-11-22%20143101.png)

8. **<mark><font color = red>通讯方式——组播</font></mark>**
   
   发送消息给一组成员；相当于拉群；
   
   发送数据给**一组用户**，又不占用资源，安全的传达；

## 虚拟化中的网络架构

![](./屏幕截图%202022-11-22%20151628.png)


1. **<font color = cornflowerblue>上行链路</font>**
   
   服务器连接物理交换机的接口，用于将数据通过网路发送给物理交换机；或者与其他的服务器进行通信；

2. **<font color = cornflowerblue>端口组</font>**
   
   - 具有**相同属性**组合的端口，e.g.    VLAN, QOS，统称为端口组；
     
     <u>**由于不需要路由**</u>，直接在链路上进行 **ARP 广播**，寻找另外交换机，直接通信；
     
     > 同一主机，相同端口组，不需要经过物理网络
   
   - 不同端口**可以相同 VLAN**，因为还有其他属性可以配置；
   
   - 不同 VLAN 的端口组可以广播报文被隔离；
     
     > 相同主机，不同端口组（VLAN 属性不一致），需要经过物理网络
   
   > <u>**注意**</u>
   > 
   > - **DVS 是虚拟的二层交换机**
   > 
   > - **不同主机，不管端口组相不相同，都要经过物理网络**

3. **<font color = cornflowerblue>虚拟化中的关键网络资源</font>**
   
   ![](./屏幕截图%202022-11-22%20152804.png)


---

> 因为有上行链路将它们相连，所以这些交换机合并起来组成分布式虚拟交换机

## 虚拟交换机

1. **<mark><font color = red>基本概念</font></mark>**
   
   虚拟交换机原理与物理交换机一样，构建起虚拟机之间的网络，并提供虚拟机与外部网络户通的能力

2. **<mark><font color = red>分类</font></mark>**
   
   - <u>**标准虚拟交换机**</u>
     
     在华为的平台中不存在标准虚拟交换机的概念
   
   - <u>**分布式虚拟交换机**</u>

3. **<mark><font color = red>华为虚拟交换机的交换类型</font></mark>**
   
   - <u>普通模式</u>
     
     Domain0 网桥队列一次数据拷贝
     
     > 主机资源开销大
   
   - <u>直通模式</u>
     
     虚拟机独立报文对列 Hypervisor 完成地址转换
     
     > 主机资源开销小
   
   - <u>SR-IOV 直通模式</u>
     
     SR-IOV 硬件完成地址转换
     
     > 主机资源开销最小，损失热迁移、快照等特性

4. **<mark><font color = red>虚拟交换端口</font></mark>**
   
   虚拟交换端口是虚拟交换机的一部分，通过与虚拟网卡相连使虚拟机能够接入到网络中

5. **<mark><font color = red>端口组定义和功能</font></mark>**
   
   - 为了方便管理，多个具有相同属性的虚拟交换端口组成一个端口组；
   
   - 端口组与物理交换机中的端口一样，通过配置端口组的属性来确定与其相连的虚拟机的网络属性，使虚拟机迁移后网络属性保持不变；

6. **<mark><font color  = red>端口组属性</font></mark>**
   
   ![](./屏幕截图%202022-11-23%20002307.png)

   
   ---
   
   创建端口组
   
   ![](./屏幕截图%202022-11-23%20003101.png)


   
   ***DHCP 隔离***
   
   dhcp snooping 的概念，并且不允许发送 office 报文；
   
   > **一个 DHCP 流程**
   > 
   > - 主机想要获得 IP 地址，发送 HDCP discovery
   > 
   > - 服务器收到以后回复，office 给主机提供 IP 地址
   > 
   > ---
   > 
   > 如果相同一个广播网络，拥有多个 DHCP 服务器；
   > 
   > 因为主机只会选择第一个到达的 office 报文；

7. **<mark><font color = red>上行链路</font></mark>**
   
   是虚拟交换机的一部分，通过与 CNA 主机的物理网卡关联来连接物理网络；

## 创建虚拟网络资源

1. **<font color = cornflowerblue>创建流程</font>**

   ![](./屏幕截图%202022-11-23%20004348.png)



2. **<font color = cornflowerblue>创建分布式交换机</font>**
   
   设置名称  >>  选择交换模式  >>  确定是否开启 IGMP Snooping 【用于组播】
   
   ---
   
   【***IGMP Snooping***】
   
   Internet Group Management Protocol Snooping 是交换机的一种高级功能，交换机通过**侦听组播协议**报文来维护组播报文的出端口信息，从而管理和控制组播数据报文的转发；

3. **<font color = cornflowerblue>添加上行链路</font>**
   
   选择主机  >>  选择网口【单独、绑定】  >>  设置 VTEP

4. **<font color = cornflowerblue>端口绑定</font>**
   
   - 端口绑定是将多个物理网口绑定成一个逻辑端口以提高传输速率及增加连接的可靠性；
   
   - 端口绑定的模式有
     
     - *主备*
     
     - *基于轮询的负荷分担*
     
     - *基于源目的 IP 和端口负荷分担*
     
     - *基于源目的 MAC 的负荷分担*
     
     - *基于源目的 MAC 的 LACP*
     
     - *基于源目的 IP 的 LACP*

5. **<font color = cornflowerblue>确定端口组连接方式</font>**
   
   - 端口组连接方式有两种，**子网方式和 VLAN 方式**
     
     - 选择子网，需要添加子网
       
       1. 系统会根据子网配置的 IP 地址池，为使用该端口的虚拟机网卡**自动分配** IP 地址
       
       2. 可设置的子网参数有：名称，描述，子网，子网掩码，网关，保留 IP 段，域名，首选 DNS 服务器，首选 WINS 服务器，VLAN ID
     
     - 选择 VLAN，需要添加 VLAN 池
       
       1. VLAN 是虚拟端口的属性之一，也是端口组属性之一
       
       2. VLAN 用途在物理网络中一样
       
       3. VLAN 池为虚拟端口和端口组提供可用的 VLAN 资源

6. **<font color = cornflowerblue>创建端口组</font>**
   
   设置属性【名称 / 类型】  >>  连接方式【子网 / VLAN】  >>  信息核对

## 虚拟网络和物理网络的管理

1. **<mark><font color = red>网络管理</font></mark>**
   
   - 当相关的网络资源全部具备后，需要对网络进行管理，来实现虚拟机之间、虚拟机与外界的正常通信；
   
   - 网络管理**可划分为虚拟网络管理**和**物理网络管理**
     
     - <u>**虚拟网络管理**</u>
       
       1）虚拟网卡
       
             虚拟机认为网络真实的一个设备
       
       2）虚拟端口
       
             连接虚拟网卡的一个端口
       
       3）上行链路
       
             选择连接服务器的接口
     
     - <u>**物理网络管理**</u>
       
       1）物理网口
       
       2）物理接口

2. <mark>**<font color = red>数据转发过程</font>**</mark>
   
   - <u>虚拟网卡</u>
     
     获取到系统从 MAC 地址段分配来的地址
   
   - <u>端口组</u>
     
     根据端口组属性来数据进行处理
   
   - <u>上行链路</u>
     
     从关联的物理网口转发数据
   
   - <u>物理网口</u>
     
     从上行链路接收数据并转发到物理网络
   
   - <u>物理接口</u>
     
     根据配置对数据做处理

3. <mark>**<font color = red>VLAN ID</font>**</mark>
   
   - 端口组和物理接口对数据帧的操作主要根据 VLAN ID 来执行
   
   - 操作主要包括
     
     - 对**不带** VLAN ID 的数据帧进行添加
     
     - 对**带** VLAN ID 的数据帧进行玻璃
     
     - 对**带** VLAN ID 的数据帧进行转发
     
     - 对**带** VLAN ID 的数据帧进行丢弃

4. **<mark><font color = red>端口镜像</font></mark>**
   
   - 属于网络管理中的一个功能，物理交换机和虚拟交换机都支持
   
   - 端口镜像可用将源端口的数据包镜像到目的端口，从而可以实现在目的端口**监控源端口**流量信息，用于数据分析和网络问题诊断

# 服务器虚拟化——虚拟机和模板

## 虚拟机和跳板

1. **<font color = cornflowerblue>虚拟化的基本架构</font>**
   
   ![](./屏幕截图%202022-11-23%20014327.png)

   
   - ***主机 / 虚拟化层***【物理服务器】
     
     物理服务器安装  FusionCompute 主机操作系统后，可将其上的计算资源（<u>内存、CPU</u>）虚拟化，即生成虚拟化层；
   
   - ***虚拟化计算资源池***
     
     主机上的计算资源经过虚拟化后，形成计算资源池，一般**同一集群内主机的计算资源**形成**一个计算资源池**；
   
   - ***虚拟 CPU, 虚拟内存 / 虚拟机***
     
     创建虚拟机时，按定义的虚拟机规格**自动**从**资源池中**为虚拟机分配**相应量的**内存和 CPU；
     
     > **说明**：
     > 
     > 一台虚拟机所使用的内存资源和 CPU 资源只能由同一台主机提供；
     > 
     > 但如果虚拟机运行的主机发生故障，可立即由另一台主机为该虚拟机提供计算资源；
     > 
     > 因此，虚拟机实际可使用计算资源的最大限度<u>**不能超过该主机的硬件规格**</u>

2. **<font color = cornflowerblue>什么是虚拟机</font>**
   
   - 虚拟机与物理计算机一样，是运行操作系统和应用程序的虚拟计算机；
   
   - 虚拟机**运行在某个主机上**，并从主机上获取所需的CPU、内存等计算资源，以及图形处理器、USB设备、网络连接和存储访问等能力；**多台虚拟机可以同时运行在一台主机中**；
   
   - 创建虚拟机时，可以选择创建位置为**主机或集群**。虚拟机创建完成后，可以对虚拟机进行迁移，对虚拟机的规格或外设进行调整，例如<u>添加网卡、绑定磁盘、挂载光驱、绑定图形处理器、绑定USB设备等</u>；
   
   > 最好是集群创建，且以上示例操作的前提条件是**安装 Tools**

3. **<font color = cornflowerblue>虚拟机的优势</font>**
   
   - <mark>虚拟化前</mark>
     
     - IT 资源独立
     
     - 操作系统与硬件紧耦合
   
   - <mark>虚拟化后</mark>
     
     - 资源抽象成共享资源池
     
     - 操作系统与硬件解耦，从资源池中分配资源
     
     - **整个虚拟机**（硬件配置、BIOS 配置、内存状态、磁盘状态、CPU 状态）都储存在独立于物理硬件的**一小组文件中**；
       
       这样只需复制几个文件就可以随时随地地根据需要复制、保存和移动虚拟机；

4. **<font color = cornflowerblue>创建虚拟机的方式</font>**
   
   | 创建方式       | 说明                                                                                                                                  |
   | ---------- | ----------------------------------------------------------------------------------------------------------------------------------- |
   | 创建空虚拟机     | - 空虚拟机就像一台没有安装操作系统的空白物理计算机；<br/>- 空虚拟机创建完成后，需要在上面安装操作系统；安装操作系统的方法与在物理机上安装操作系统的方法相同；<br/>- **通常在系统初始部署时，或系统中没有适合的模板或虚拟机时**，需要创建空虚拟机； |
   | 使用模板创建虚拟机  | - 使用模板创建和模板相似的虚拟机；将模板转为虚拟机，虚拟机的所有属性和模板相同，转换完成后，模板不再存在。<br/>- 通常在系统中有适合的模板时，或其他站点有合适的模板可以导出时，使用模板创建虚拟机可节省时间；                         |
   | 使用虚拟机创建虚拟机 | - 以系统中已有的一个虚拟机为副本，克隆一个和**该虚拟机相似的**虚拟机。<br/>- 要部署多个类似的虚拟机时，可在单个虚拟机上创建、配置和安装不同的软件，然后将该虚拟机克隆多次，而不用分别创建和配置每个虚拟机；                        |

5. **<font color = cornflowerblue>制作模板的方式</font>**
   
   - <u>**虚拟机转为模板**</u>
     
     将虚拟机直接转换为模板，所有参数均使用该虚拟机当前设置；转换后，**该虚拟机不再存在；**
     
     > 虚拟机关机，右键转为模板
   
   - <u>**虚拟机克隆为模板**</u>
     
     复制虚拟机为模板并可调整部分参数设置，使其与虚拟机稍有不同；克隆完成后，该虚拟机仍可以正常使用；
     
     > 右键克隆为模板
   
   - <u>**模板克隆为模板**</u>
     
     复制模板为新模板并可调整部分参数设置，使其与原模版稍有不同，克隆完成后，原模版仍存在；
     
     > 右键克隆为模板

6. **<font color = cornflowerblue>虚拟机与虚拟机模板的区别</font>**
   
   |          | 虚拟机                               | 虚拟机模板                                     |
   | -------- | --------------------------------- | ----------------------------------------- |
   | **可用性**  | 虚拟机与物理计算机一样，是运行操作系统和应用程序的虚拟机=计算机  | 模板是虚拟机的一个副本，包含操作系统、应用软件和虚拟机规格配置，但是不能直接运行； |
   | **资源占用** | 虚拟机运行在某个主机上，需要主机提供 CPU, 内存, 存储等资源 | 模板不能直接运行，所以也不会真正占用主机的资源；                  |
   | **用途**   | 虚拟机的主要用途是作为应用程序的运行载体，用于处理计算任务；    | 模板的主要用途是用于**批量**创建虚拟机；                    |

7. **<font color = cornflowerblue>虚拟机与模板导出</font>**
   
   - 将系统内的模板或虚拟机导出到本地作为虚拟机的模板，便可以其他系统中使用该模板**创建与模板设置一致的虚拟机**，达到快速部署的目的；
   
   - 虚拟机和模板的导出可用通过 FusionCompute 中的 “导出模板 / 导出虚拟机” 操作实现
   
   - 格式可选 ova 或 ovf 模板

8. **<font color = cornflowerblue>模板导入</font>**
   
   根据数据来源不同，分三种方式
   
   - <u>**从共享目录导入**</u>
     
     需先将保存在本地 PC 或其他网络设备的虚拟机模板所在文件夹共享给某个用户，使主机可通过网络地址访问虚拟机模板文件，并通过用户名和密码进行鉴权；
   
   - <u>**从本地导入**</u>
     
     仅需要将模板文件保存在本地 PC 即可
   
   - <u>**从网络服务器导入**</u>
     
     需将模板文件存放在 HTTP 协议的网络服务器中，使主机可通过 HTTP 地址访问，且无需鉴权；

9. **<font color = cornflowerblue>虚拟机镜像与操作系统镜像的区别</font>**
   
   - 虚拟机镜像就是前文所说的虚拟机模板，是虚拟机的一个副本，包含操作系统、应用软件和虚拟机规格配置等数据，用于创建与模板设置一致的虚拟机，实现快速部署的功能；
   
   - 操作系统镜像指的是把操作系统**安装光盘**中的所有数据打包并压缩所生成的**特殊格式的文件**，通常以 .iso 作为文件扩展名，包含了安装操作系统所需要的所有文件，既可以用于安装物理机的操作系统，页可以用于安装虚拟机的操作系统；

## 虚拟机的 Tools

1. **<mark><font color = red>Tools 的本质</font></mark>**
   
   Tools 是一个性能优化程序，为虚拟机安装 Tools 可以让其获取到更好的性能，这样也意味着在用户操作窗口会有更好的体验；

2. **<mark><font color = red>兼容行业特殊操作系统</font></mark>**
   
   ![](./屏幕截图%202022-11-23%20171326.png)

   
   兼容一个新的操作系统，需要厂商提供**配套的 PV 驱动程序**，华为具有 PV 驱动开发能力；
   
   FusionCompute 除了兼容主流的 Windows, Linux 操作系统之外，还兼容国产中标操作系统（<u>特定的版本可能需要定制驱动</u>）

3. **<mark><font color = red>Tools 的用途</font></mark>**
   
   - 为虚拟机提供**高性能**的磁盘 I / O 和网络 I / O 功能；
   
   - 为虚拟机提供虚拟硬件**监控功能**
     
     - 获取虚拟机指定网卡 IP 信息
     
     - 获取虚拟机内部各 CPU 利用率、内存利用率
     
     - 获取虚拟机内各个磁盘 / 分区的空间使用信息
   
   - 为虚拟机提供**高级功能**
     
     - 迁移虚拟机
     
     - 安全关闭虚拟机、安全重启虚拟机、休眠虚拟机
     
     - 在线调整虚拟机的 CPU 规格
     
     - 创建虚拟机快照
     
     - 虚拟机蓝屏检测
     
     - 虚拟机与主机时钟同步
     
     - 虚拟机网卡的高级功能，如 QoS，流量整型，ARP 广播抑制，DHCP 隔离，IP 与 MAC 绑定
     
     - 自动升级虚拟机的驱动程序，如 Tools 和智能网卡驱动

4. **<mark><font color = red>Windows 安装 Tools 的前提</font></mark>**
   
   - 虚拟机已安装操作系统
   
   - 虚拟机未安装其他版本的 Tools，如果已安装请参考在 Windows 系统中卸载 Tools 卸载
   
   - 虚拟机系统磁盘的剩余空间**必须大于32 MB**
   
   - 如果虚拟机的操作系统为 Windows 2008 和 Windows 7，需使用 Administrator 用户安装 Tools

5. **<mark><font color = red>Linux 安装 Tools 的前提</font></mark>**
   
   - 虚拟机已安装操作系统
   
   - 虚拟机未安装其他版本的 Tools
   
   - 虚拟机系统磁盘的剩余空间**必须大于20 MB**
   
   - 虚拟机操作系统已安装 gzip 工具，可以使用 `tar` 命令对压缩包进行解压；
   
   - 若虚拟机的操作系统类型为 Red Hat Enterprise Linux 4.7 / 6.0 (32 / 64 位) 或 CentOS 4.7 / 6.0 (32 / 64 位)，安装 Tools 前需先替换内核文件；

6. **<mark><font color = red>安装 Tools</font></mark>**
   
   ![](./屏幕截图%202022-11-24%20010618.png)

## 虚拟机的创建

1. **<font color = cornflowerblue>创建虚拟机流程</font>**
   
   开始  >>  创建方式  >>  确定名称  >>  选择资源  >>  选择操作系统  >>  配置虚拟机属性  >>  确认信息  >>  检查进度  >>  完成

2. **<font color = cornflowerblue>配置虚拟机属性 -- CPU 数量</font>**
   
   - <u>**基本参数**</u>
     
     - 总内核数
     
     - 单内核数
     
     - 插槽数
       
       插槽数 = 总内核数 / 单内核数
     
     ![](./屏幕截图%202022-11-24%20011657.png)


3. **<font color = cornflowerblue>配置虚拟机属性 -- CPU QoS</font>**
   
   > **CPU QoS** 指当服务器上的虚拟机资源紧张时可以分配的额度；
   
   - **份额** 表示虚拟机可占用主机系统资源的比例关系；
     
      ![](./%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202022-11-24%20012007.png?msec=1669224063157)

   
   - **预留** 表示主机保留给虚拟机的最低资源量，这部分资源量不能被其他虚拟机占用
   
   - **限制** 表示虚拟机可以使用的最大的资源量，虚拟机一旦达到限制的资源量，将无法继续占用更多的主机资源

4. **<font color = cornflowerblue>配置虚拟机属性 -- 图形处理器</font>**
   
   - 当虚拟机需要具备高性能的图形应用能力时，需要管理员将主机上的图形处理器绑定给该虚拟机
   
   - 给虚拟机添加图形处理器**支持自动分配**和**指定绑定**两种方式
     
     - <u>**自动分配**</u>
       
       默认绑定方式；
       
       可设置 ”直通“ 和 ”虚拟化“ 两张使用方式
     
     - <u>**指定绑定**</u>
       
       选择绑定 GPU 设备

5. **<font color = cornflowerblue>配置虚拟机属性 -- 时钟</font>**
   
   定时任务，时钟需要相同

6. **<font color = cornflowerblue>配置虚拟机属性 -- 可靠性</font>**
   
   ![](./屏幕截图%202022-11-24%20021337.png)


7. **<font color = cornflowerblue>配置虚拟机属性 -- 安全性</font>**
   
   安装安全相关虚拟机
